<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bike Yard App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f8f8;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 10px;
      position: relative;
    }
    .background-image {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      z-index: -1;
      opacity: 0.1;
    }
    input[type="text"], input[type="number"], textarea {
      width: calc(100% - 20px);
      padding: 10px;
      margin: 5px 0;
      box-sizing: border-box;
    }
    button {
      padding: 10px 20px;
      color: #fff;
      border: none;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      background-color: black;
    }
    #bookBtn {
      background-color: #007bff;
    }
    #repairBtn {
      background-color: #dc3545;
    }
    #exportBtn {
      background-color: #28a745;
    }
    .dashboard {
      background-color: yellow;
      padding: 10px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      border: 2px solid red;
      margin-bottom: 20px;
    }
    .dashboard img {
      height: 40px;
    }
    .note {
      background-color: #ffc107;
    }
    #errorMessage {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }
    .button-container {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }
    #submitBtn {
      background-color: black;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
</head>
<body>
  <header>
    <div class="dashboard">
      <img src="https://img.icons8.com/ios-filled/50/000000/bicycle.png" alt="Bike Logo">
      <h1>Bike Yard Owner Dashboard</h1>
    </div>
  </header>
  <div class="container">
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRLLU40gx6sGv6dKhbyc4AOVtlDFVVetXmpyg&s" alt="Background" class="background-image">
    <div class="button-container">
      <button id="bookBtn" onclick="showBookForm()">Book</button>
      <button id="repairBtn" onclick="showRepairForm()">Repair</button>
      <button id="exportBtn" onclick="exportData()">Export Data</button>
    </div>
    <form id="bikeForm" style="display: none;" action="https://bikeyard1.000.pe/connect.php" method="post" onsubmit="handleSubmit(event)">
      <input type="text" id="name" placeholder="Name" required name="name">
      <input type="text" id="id" placeholder="ID" name="id">
      <input type="text" id="phone" placeholder="Phone Number" name="phone">
      <input type="number" id="hours" placeholder="Hours" name="hours">
      <input type="text" id="cycleCode" placeholder="Cycle Code" required name="cycle_code">
      <textarea id="note" placeholder="Note (optional)" class="note" name="note"></textarea>
      <input type="hidden" name="form_type" id="form_type">
      <input type="hidden" name="submission_date" id="submission_date">
      <div id="errorMessage"></div>
      <button type="submit" id="submitBtn">Submit</button>
    </form>
  </div>
  <script>
    let submittedData = [];
    let currentType = '';

    function showBookForm() {
      currentType = 'book';
      document.getElementById('form_type').value = 'book';
      document.getElementById('bikeForm').style.display = 'block';
      document.getElementById('id').style.display = 'block';
      document.getElementById('phone').style.display = 'block';
      document.getElementById('hours').style.display = 'block';
      document.getElementById('note').placeholder = 'Note (optional)';
      document.getElementById('name').focus();
      document.getElementById('errorMessage').innerHTML = '';
    }

    function showRepairForm() {
      currentType = 'repair';
      document.getElementById('form_type').value = 'repair';
      document.getElementById('bikeForm').style.display = 'block';
      document.getElementById('id').style.display = 'none';
      document.getElementById('phone').style.display = 'none';
      document.getElementById('hours').style.display = 'none';
      document.getElementById('note').placeholder = 'Problem';
      document.getElementById('name').focus();
      document.getElementById('errorMessage').innerHTML = '';
    }

    function exportData() {
      const wb = XLSX.utils.book_new();

      const bookData = submittedData.filter(data => data.form_type === 'book');
      const repairData = submittedData.filter(data => data.form_type === 'repair');

      const wsBookData = bookData.map(data => [data.name, data.id, data.phone, data.hours, data.cycle_code, data.note, data.submission_date]);
      const wsRepairData = repairData.map(data => [data.name, data.cycle_code, data.note, data.submission_date]);

      const wsBook = XLSX.utils.aoa_to_sheet([['Name', 'ID', 'Phone Number', 'Hours', 'Cycle Code', 'Note', 'Submission Date'], ...wsBookData]);
      const wsRepair = XLSX.utils.aoa_to_sheet([['Name', 'Cycle Code', 'Problem', 'Submission Date'], ...wsRepairData]);

      XLSX.utils.book_append_sheet(wb, wsBook, 'Bookings');
      XLSX.utils.book_append_sheet(wb, wsRepair, 'Repairs');

      XLSX.writeFile(wb, 'bike_yard_data.xlsx');
    }

    function handleSubmit(event) {
      event.preventDefault();
      const formData = new FormData(event.target);

      const submissionDate = new Date().toISOString();
      formData.set('submission_date', submissionDate);

      const formObject = Object.fromEntries(formData);
      submittedData.push(formObject);
      console.log("Submitted Data:", submittedData);

      fetch(event.target.action, {
        method: 'POST',
        body: formData
      })
      .then(response => response.text())
      .then(data => {
        console.log("Server Response:", data);
        if (data.includes('Success')) {
          alert("Form submitted successfully!");
          event.target.reset();
          document.getElementById('bikeForm').style.display = 'none';
        } else {
          throw new Error(data);
        }
      })
      .catch(error => {
        console.error("Error:", error);
        document.getElementById('errorMessage').innerHTML = 'Submission failed. Please try again.';
      });
    }
  </script>
</body>
</html>
